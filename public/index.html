<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
  </head>
  <body id="body" style="background-color:black">
  

  <script src="/javascripts/visualizer.js"></script>
  <script>
    vz.start({'width' : 800, 'height': 500, 'screen': document.getElementById('body')});
  </script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    function triggerHit(noteNumber){
      var scaledNote = noteNumber % 10;
      vz.detector.bandLikelihood[scaledNote] = 10;
      setTimeout(function(){
        vz.detector.bandLikelihood[scaledNote] = 0;
      }, 10);
    }

    function handleMidiNote(midiData){
      var note = midiData.note;
      switch (note[0]){
        //note on
        case 144:
          console.log(note[1]);
          triggerHit(note[1]);
          break;

        //note off
        case 128: 
          // console.log
          break;

        default:
          break;
        }
    }
    

    // add socket listeners   
    socket.on('midiNote', handleMidiNote);
    socket.on('command', function(data){
        console.log(data);
      }); 
  </script>
  </body>
</html>